//Config.cpp设置

#include <fstream>
#include <string>
#include <system_error>

#include <Windows.h>
#include <ShlObj.h>

#include "Json/json.hpp"

#include "CheatManager.hpp"
#include "Memory.hpp"
#include "Utils.hpp"

void Config::init() noexcept
{
	if (PWSTR pathToDocuments; SUCCEEDED(SHGetKnownFolderPath(FOLDERID_Documents, 0, nullptr, &pathToDocuments))) {
		this->path = pathToDocuments;
		CoTaskMemFree(pathToDocuments);
	}

	this->path /= "Sakura";
}

void Config::save() noexcept
{
	static const auto player{ cheatManager.memory->localPlayer };
	std::error_code ec;
	std::filesystem::create_directory(this->path, ec);
	auto out{ std::ofstream(this->path / u8"Sakura")};

	if (!out.good())
		return;

	config_json["menuKey"] = this->menuKey.toString();
	config_json["currentComboSkinIndex"] = this->currentComboSkinIndex;
	config_json["curretSkinId"] = this->curretSkinId;

	out << config_json.dump();
	out.close();
}

void Config::load() noexcept
{
	const auto player{ cheatManager.memory->localPlayer };
	auto in{ std::ifstream(this->path / u8"Sakura") };

	if (!in.good())
		return;

	if (json j{ json::parse(in, nullptr, false, true) }; j.is_discarded())
		return;
	else
		config_json = j;

	this->menuKey = KeyBind(config_json.value("menuKey", "INSERT").c_str());
	this->currentComboSkinIndex = config_json.value("currentComboSkinIndex", 0);
	this->curretSkinId = config_json.value("curretSkinId", 1);

	if (this->curretSkinId < 1)
		this->curretSkinId = 1;

	in.close();
}

void Config::reset() noexcept
{
	this->menuKey = KeyBind(KeyBind::INSERT);
	this->currentComboSkinIndex = 0;
	this->curretSkinId = 1;
}
----------------------------------------------------------------------------------------------------------------------------------------------------------
//config.hpp设置

#pragma once

#include <cstdint>
#include <filesystem>
#include <map>

#include "json/json.hpp"

#include "Utils.hpp"

using json = nlohmann::json;

class Config {
public:
	void init() noexcept;
	void save() noexcept;
	void load() noexcept;
	void reset() noexcept;

	KeyBind menuKey{ KeyBind(KeyBind::INSERT) };
	std::int32_t currentComboSkinIndex{ 0 };
	std::int32_t curretSkinId{ 1 };
private:
	std::filesystem::path path;
	json config_json{ json() };
};
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------
//GUI.cpp设置

#include <cstdint>
#include <string>
#include <mutex>
#include <vector>
#include <variant>
#include <tuple>

#include "imgui/imgui.h"
#include "imgui/imgui_stdlib.h"

#include "CheatManager.hpp"
#include "GUI.hpp"
#include "Memory.hpp"
#include "SkinDatabase.hpp"
#include "Utils.hpp"

inline void footer() noexcept
{
	ImGui::Separator();
	ImGui::textUnformattedCentered((std::string("编译时间: ") + __DATE__ + " - " + __TIME__).c_str());
	ImGui::textUnformattedCentered("本软件完全免费，请勿上当受骗花钱购买");
}

void GUI::render() noexcept
{
	static const auto player{ cheatManager.memory->localPlayer };
	static bool show_log = false;
	if (show_log) {
		ImGui::Begin("Log", nullptr);
		cheatManager.logger->draw();
	}
	static const auto vectorGetter = [](void* vec, const std::int32_t idx, const char** out_text) noexcept
		{
			const auto& vector{ *static_cast<std::vector<SkinDatabase::PetsInfo>*>(vec) };
			if (idx < 0 || idx > static_cast<std::int32_t>(vector.size())) return false;
			*out_text = idx == 0 ? "Default" : vector.at(idx - 1).skinName;
			return true;
		};

	std::call_once(this->changeSkin, [&]() noexcept -> void {
		const auto& pet{ cheatManager.database->pets[cheatManager.config->currentComboSkinIndex - 1] };
		std::int32_t count{ 0 };
		if (std::holds_alternative<std::int32_t>(pet.skinCount))
			count = std::get<std::int32_t>(pet.skinCount);
		else if (std::holds_alternative<std::pair<std::int32_t, std::int32_t>>(pet.skinCount))
			count = std::get<std::pair<std::int32_t, std::int32_t>>(pet.skinCount).second;

		if (cheatManager.config->currentComboSkinIndex > 0 && cheatManager.config->curretSkinId > count)
			cheatManager.config->curretSkinId = 1;

		if (cheatManager.config->currentComboSkinIndex > 0)
			player->changeSkin(cheatManager.database->pets[cheatManager.config->currentComboSkinIndex - 1].modelName, cheatManager.config->curretSkinId);
		});

	ImGui::StyleColorsDark();	//设置界面风格（1.ImGui::StyleColorsDark(); 2.//ImGui::StyleColorsLight();  3.//ImGui::StyleColorsClassic();）

	ImGuiStyle& style = ImGui::GetStyle(); // 获取当前的ImGui样式

	style.Alpha = 0.7f; // 修改窗口背景色的alpha值为0.7（70%透明度）

	ImGui::Begin("R3nzSkinTFT", nullptr, ImGuiWindowFlags_NoCollapse | ImGuiWindowFlags_NoResize | ImGuiWindowFlags_NoScrollbar | ImGuiWindowFlags_NoScrollWithMouse | ImGuiWindowFlags_AlwaysAutoResize);
	if (ImGui::BeginTabBar("TabBar", ImGuiTabBarFlags_Reorderable | ImGuiTabBarFlags_FittingPolicyScroll | ImGuiTabBarFlags_NoTooltip)) {

		if (ImGui::BeginTabItem("小小英雄设置")) {
			if (ImGui::Combo("皮肤选择", &cheatManager.config->currentComboSkinIndex, vectorGetter, static_cast<void*>(&cheatManager.database->pets), cheatManager.database->pets.size() + 1)) {
				const auto& pet{ cheatManager.database->pets[cheatManager.config->currentComboSkinIndex - 1] };
				if (std::holds_alternative<std::int32_t>(pet.skinCount))
					cheatManager.config->curretSkinId = 1;
				else if (std::holds_alternative<std::pair<std::int32_t, std::int32_t>>(pet.skinCount))
					cheatManager.config->curretSkinId = std::get<std::pair<std::int32_t, std::int32_t>>(pet.skinCount).first;
			}

			const auto& pet{ cheatManager.database->pets[cheatManager.config->currentComboSkinIndex - 1] };
			if (std::holds_alternative<std::int32_t>(pet.skinCount)) {
				ImGui::SliderInt("拖动选择形态", &cheatManager.config->curretSkinId, 1, std::get<std::int32_t>(pet.skinCount));
			}
			else if (std::holds_alternative<std::pair<std::int32_t, std::int32_t>>(pet.skinCount)) {
				const auto pair{ std::get<std::pair<std::int32_t, std::int32_t>>(pet.skinCount) };
				ImGui::SliderInt("拖动选择形态", &cheatManager.config->curretSkinId, pair.first, pair.second);
			}

			if (ImGui::Button("确认更改"))
				player->changeSkin(cheatManager.database->pets[cheatManager.config->currentComboSkinIndex - 1].modelName, cheatManager.config->curretSkinId);

			ImGui::hotkey("菜单呼出按钮（键盘）", cheatManager.config->menuKey);
			footer();
			ImGui::EndTabItem();
		}
	}
	ImGui::End();
}
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------
//中文设置
Hooks.cpp第171行
			cfg.SizePixels = 15.0f;
			io.Fonts->AddFontFromFileTTF("c:\\Windows\\Fonts\\msyh.ttc", 15.0f, nullptr,
				io.Fonts->GetGlyphRangesChineseFull());

//中文方法2设置
Hooks.cpp第171行
io.Fonts->AddFontFromFileTTF((path / "msyh.ttc").string().c_str(), cfg.SizePixels, &cfg, io.Fonts->GetGlyphRangesChineseFull());
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Sakura.rc设置

// Microsoft Visual C++ generated resource script.
//
#include "resource.h"

#define APSTUDIO_READONLY_SYMBOLS
/////////////////////////////////////////////////////////////////////////////
//
// Generated from the TEXTINCLUDE 2 resource.
//
#include "winres.h"

/////////////////////////////////////////////////////////////////////////////
#undef APSTUDIO_READONLY_SYMBOLS

/////////////////////////////////////////////////////////////////////////////
// 土耳其语(T??rkiye) resources

#if !defined(AFX_RESOURCE_DLL) || defined(AFX_TARG_TRK)
LANGUAGE LANG_TURKISH, SUBLANG_DEFAULT
#pragma code_page(1254)

#ifdef APSTUDIO_INVOKED
/////////////////////////////////////////////////////////////////////////////
//
// TEXTINCLUDE
//

1 TEXTINCLUDE 
BEGIN
    "resource.h\0"
END

2 TEXTINCLUDE 
BEGIN
    "#include ""winres.h""\r\n"
    "\0"
END

3 TEXTINCLUDE 
BEGIN
    "\r\n"
    "\0"
END

#endif    // APSTUDIO_INVOKED


/////////////////////////////////////////////////////////////////////////////
//
// Version
//

VS_VERSION_INFO VERSIONINFO
 FILEVERSION 1,0,0,0
 PRODUCTVERSION 1,0,0,0
 FILEFLAGSMASK 0x3fL
#ifdef _DEBUG
 FILEFLAGS 0x1L
#else
 FILEFLAGS 0x0L
#endif
 FILEOS 0x40004L
 FILETYPE 0x2L
 FILESUBTYPE 0x0L
BEGIN
    BLOCK "StringFileInfo"
    BEGIN
        BLOCK "000004b0"
        BEGIN
            VALUE "CompanyName", "R3nzSkinTFT Inc."
            VALUE "FileDescription", "R3nzSkinTFT DLL"
            VALUE "FileVersion", "1.0.0.0"
            VALUE "InternalName", "R3nzSkinTFT.dll"
            VALUE "LegalCopyright", "Copyright (c) 2023 R3nzSkinTFT"
            VALUE "OriginalFilename", "R3nzSkinTFT.dll"
            VALUE "ProductName", "R3nzSkinTFT DLL"
            VALUE "ProductVersion", "1.0.0.0"
        END
    END
    BLOCK "VarFileInfo"
    BEGIN
        VALUE "Translation", 0x0, 1200
    END
END

#endif    // 土耳其语(T??rkiye) resources
/////////////////////////////////////////////////////////////////////////////



#ifndef APSTUDIO_INVOKED
/////////////////////////////////////////////////////////////////////////////
//
// Generated from the TEXTINCLUDE 3 resource.
//


/////////////////////////////////////////////////////////////////////////////
#endif    // not APSTUDIO_INVOKED
